@model List<CartItemDto>
@{

   var products = ViewBag.Products;
   var products2 = ViewBag.Products2;
}

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />





    <link rel="stylesheet" href="~/css/Cart.css">



    <div id="body_cart" class="body_cart ">
        
        @if ( Model.Count == 0)
        {
            <div class="container">
                <div class="row carthome justify-content-center ">
                    <div class=" row cart col-lg-11 ">
                        <div class="cartelement col-12 col-md-4">
                            <div class="cart_Img">   <img src="./ImageCart/download.png" alt="img Cart"></div>
                        <div class="cart-empty"><p>@Localizer["Yourshoppingcartisempty!"]</p></div>
                        <span class="cart-p">@Localizer["TechStore"]</span>
                            <a asp-controller="Home" asp-action="Index" class="btn ShopNaw" type="button">@Localizer["ShopNaw"]</a>
                        </div>



                    </div>

                </div>
            </div>
            <div class="container">
                <div class="row carthome justify-content-center  ">
                <h3 dir="auto" > @Localizer["RecentlyAdded"] </h3>

                <div class=" row cart col-lg-11 ">
                    <div id="carouselExampleControls" class="carousel slide carousel-dark " data-bs-ride="carousel">
                        <div class="carousel-inner ">
                            <div class="carousel-item active">
                                <div class=" row cols-sm-4 cols-md-2 cols-lg-4 ">
                                        @foreach (var product in products)
                                        {
                                            string formattedPrice = string.Format("{0:#,0}", product.Price);
                                            string formattedDiscountedPrice = string.Format("{0:#,0}", product.DiscountedPrice);

                                            <div class="card mb-3">
                                                <a class="listingWrapperSection" style="text-decoration:none; color:black" asp-controller="Product" asp-action="Details" asp-route-id="@product.Id">
                                                    <div class="cart-img">
                                                        <img src="@((product.Images.Count > 0) ? product.Images[0] : string.Empty)" class="card-img-top" alt="..." style="width:100%; height:auto;">
                                                    </div>
                                                </a>
                                                <div class="card-body">
                                                    <div class="product details product-item-details">
                                                        <span data-bind="text: item.name">@product.Description</span>
                                                    </div>
                                                    <div class="price-and-button mt-auto">
                                                        @if (product.DiscountValue > 0)
                                                        {
                                                            <p id="itemprice" class="cart-price">@formattedDiscountedPrice<span class="cart-EGP">EGP</span></p>
                                                        }
                                                        else
                                                        {
                                                            <p id="itemprice" class="cart-price">@formattedPrice<span class="cart-EGP">EGP</span></p>
                                                        }
                                                        <div class="btn-carts">
                                                            <form asp-action="AddToCart" asp-controller="Cart" method="post">
                                                                <input type="hidden" name="productId" value="@product.Id" />
                                                                <input type="hidden" name="Description" value="@product.Description" />
                                                                @* Check for discounts *@
                                                                <input type="hidden" name="price" value="@product.Price" />
                                                                <input type="hidden" name="DiscountValue" value="@product.DiscountValue" />
                                                                <input type="hidden" name="DiscountedPrice" value="@product.DiscountedPrice" />
                                                                <input type="hidden" name="CopyQuantity" value="@product.Quantity" />
                                                                <input type="hidden" name="image" value="@((product.Images.Count > 0) ? product.Images[0] : string.Empty)" />
                                                                <input type="hidden" name="quantity" value="1" min="1" />
                                                            <button id="btn_mycart" class="btn btn-dark">@Localizer["AddtoCart"] </button>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        


                                    <div class="spacer"></div>
                               }
                                </div>
                            </div>
                            <div class="carousel-item">
                                <div class=" row cols-1 cols-md-2 cols-lg-4">

                                        @foreach (var product in products2)
                                        {

                                            string formattedPrice = string.Format("{0:#,0}", product.Price);

                                            <div class="card">
                                                <a class="listingWrapperSection" style="text-decoration:none; color:black" asp-controller="Product" asp-action="Details" asp-route-id="@product.Id">
                                                    <div class="cart-img">
                                                        <img src="@((product.Images.Count > 0) ? product.Images[0] : string.Empty)" class="card-img-top" alt="..." style="width:100%; height:auto;">
                                                    </div>
                                                </a>
                                                <div class="card-body">
                                                    <p id="itemtext" class="card-text">@product.Description</p>
                                                    <div class="price-and-button">
                                                        @if (product.DiscountValue>0)
                                                        {
                                                            string formattedDiscountedPrice = string.Format("{0:#,0}", product.DiscountedPrice);

                                                            <p id="itemprice" class="cart-price">@formattedDiscountedPrice<span class="cart-EGP">EGP</span></p>

                                                        }
                                                        else
                                                        {
                                                            <p id="itemprice" class="cart-price">@formattedPrice<span class="cart-EGP">EGP</span></p>
                                                        }
                                                        <div class="btn-carts">
                                                            <form asp-action="AddToCart" asp-controller="Cart" method="post">
                                                                <input type="hidden" name="productId" value="@product.Id" />
                                                                <input type="hidden" name="Description" value="@product.Description" />
                                                                @* Check for discounts *@
                                                                <input type="hidden" name="price" value="@product.Price" />
                                                                <input type="hidden" name="DiscountValue" value="@product.DiscountValue" />
                                                                <input type="hidden" name="DiscountedPrice" value="@product.DiscountedPrice" />
                                                                <input type="hidden" name="CopyQuantity" value="@product.Quantity" />
                                                                <input type="hidden" name="image" value="@((product.Images.Count > 0) ? product.Images[0] : string.Empty)" />
                                                                <input type="hidden" name="quantity" value="1" min="1" />
                                                            <button id="btn_mycart" class="btn btn-dark">@Localizer["AddtoCart"]</button>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="spacer "></div>
                                        }

                                </div>
                            </div>

                        </div>
                        <button class="carousel-control-prev  " id="button1" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Previous</span>
                        </button>
                        <button class="carousel-control-next hidden " id="button2" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="visually-hidden ">Next</span>
                        </button>
                    </div>
                </div>
            </div>
            </div>
        }
        else
        {
            <div id="mycart" class=" mycart">
                <div class="container">
                    <div class="row carthome2 justify-content-around ">
                        <div class=" row  col-lg-12  ">
                            <div class=" col-8 part0_cart">

                                <div class="cart_itms">
                                    <div class="cart-number">
                                        <div>Cart</div>
                                        <div class="number-product">@Model.Count</div>
                                    </div>
                                    <div class="spac "></div>
                                    <div class="spac "></div>
                                    @foreach(var item in Model)
                                    {
                                        @if (item.DiscountValue > 0)
                                        {

                                            <div class="row mb-3 ">
                                                <div class="row col-9 Allproduct">
                                                    <div class="col-2 img_product">
                                                        <a class="listingWrapperSection" style="text-decoration:none; color:black" asp-controller="Product" asp-action="Details" asp-route-id="@item.ProductId">

                                                            <img id="productImg" src="@item.Image" alt="...">
                                                        </a>
                                                    </div>
                                                    <div class="col-9 prag_cart">
                                                        <p id="productName">
                                                            @item.Description
                                                        </p>
                                                        <p>Vendor : Tech.Store</p>
                                                        <p>
                                                            @{
                                                                // Format the price with no decimal numbers under 1 and commas after every 3 digits
                                                                string formattedPrice = string.Format("{0:#,0}", item.Price);
                                                            }
                                                            <span class="underline">@formattedPrice</span>   <span style="color:red">   @item.DiscountValue% of</span>
                                                            @{
                                                                // Format the discounted price with no decimal numbers under 1 and commas after every 3 digits
                                                                string formattedDiscountedPrice = string.Format("{0:#,0}", item.DiscountedPrice);
                                                            }
                                                            <h3 id="productprices" style="font-weight: bold;">@formattedDiscountedPrice</h3>
                                                    </div>

                                                </div>
                                                <div class="col-3 p-1 remove_cart">
                                                    <form id="updateQuantityForm" asp-controller="Cart" asp-action="UpdateQuantity" method="post">
                                                        <input type="hidden" name="productId" value="@item.ProductId" />
                                                        <div class="custom-dropdown">
                                                            <select id="quantityDropdown" name="quantity" class="form-control">

                                                                @for (int i = 1; i <= item.CopyQuantity; i++)
                                                                {
                                                                    if (i == item.Quantity)
                                                                    {
                                                                        <option value="@i" selected>@i</option>
                                                                    }
                                                                    else
                                                                    {
                                                                        <option value="@i">@i</option>
                                                                    }

                                                                }

                                                            </select>

                                                            <span id="dropdownIcon" class="dropdown-icon">&#9660;</span>
                                                        </div>


                                                    </form>
                                                    <form asp-controller="Cart" asp-action="RemoveFromCart" method="post">
                                                        <input type="hidden" name="productId" value="@item.ProductId" />
                                                        <div class="Remove">

                                                            <button type="submit" class="btn ">
                                                                <i class="fa-regular fa-trash-can"></i>
                                                               @Localizer["Remove"] 
                                                            </button>

                                                        </div>
                                                    </form>


                                                </div>

                                            </div>
                                            <div class="spac "></div>
                                        }
                                        else
                                        {
                                            <div class="row mb-3 ">
                                                <div class="row col-9 Allproduct">
                                                    <div class="col-2 img_product">
                                                        <a class="listingWrapperSection" style="text-decoration:none; color:black" asp-controller="Product" asp-action="Details" asp-route-id="@item.ProductId">

                                                            <img id="productImg" src="@item.Image" alt="...">
                                                        </a>
                                                    </div>
                                                    <div class="col-9 prag_cart">
                                                        <p id="productName">
                                                            @item.Description
                                                        </p>
                                                        <p> @Localizer["VendorTech.Store"] </p>
                                                        <p>
                                                            @{
                                                                // Format the price with no decimal numbers under 1 and commas after every 3 digits
                                                                string formattedPrice = string.Format("{0:#,0}", item.Price);
                                                            }
                                                            <h3 id="productprices" style="font-weight: bold;">@formattedPrice</h3>
                                                    </div>

                                                </div>
                                                <div class="col-3 p-1 remove_cart">
                                                    <form id="updateQuantityForm" asp-controller="Cart" asp-action="UpdateQuantity" method="post">
                                                        <input type="hidden" name="productId" value="@item.ProductId" />
                                                        <div class="custom-dropdown">
                                                            <select id="quantityDropdown" name="quantity" class="form-control">

                                                                @for (int i = 1; i <= item.CopyQuantity; i++)
                                                                {
                                                                    if (i == item.Quantity)
                                                                    {
                                                                        <option value="@i" selected>@i</option>
                                                                    }
                                                                    else
                                                                    {
                                                                        <option value="@i">@i</option>
                                                                    }

                                                                }

                                                            </select>

                                                            <span id="dropdownIcon" class="dropdown-icon">&#9660;</span>
                                                        </div>


                                                    </form>
                                                    <form asp-controller="Cart" asp-action="RemoveFromCart" method="post">
                                                        <input type="hidden" name="productId" value="@item.ProductId" />
                                                        <div class="Remove">

                                                            <button type="submit" class="btn ">
                                                                <i class="fa-regular fa-trash-can"></i>
                                                              @Localizer["Remove"]
                                                            </button>

                                                        </div>
                                                    </form>


                                                </div>

                                            </div>
                                            <div class="spac "></div>
                                        }
                                    }                           
                                    <div class="spac "></div>

                                </div>

                            </div>
                            <div class="col-4 part1_cart ">
                                <div class="section1 row">
                                    <div id="part1" class=" row">

                                    <div id="Quan" class="col-6   "> @Localizer["Quantity"] </div>
                                        <div id="pro" class="col-6  ">@Model.Count @Localizer["items"] </div>
                                    <div id="Subt" class="col-6   ">@Localizer["Subtotal"]</div>
                                        <div id="Egp" class="col-6   ">
                                            @{
                                                // Calculate total price
                                                decimal totalprice = 0;
                                                foreach (var item in Model)
                                                {
                                                    if (item.DiscountValue > 0)
                                                    {
                                                        totalprice += item.DiscountedPrice * item.Quantity;
                                                    }
                                                    else
                                                    {
                                                        totalprice += item.Price * item.Quantity;
                                                    }
                                                }

                                                // Format the total price with no decimal numbers under 1 and commas after every 3 digits
                                                string formattedTotalPrice = string.Format("{0:#,0}", totalprice);
                                            }
                                            <p class="cart-price">
                                                @(formattedTotalPrice)
                                                <span class="cart-EGP">EGP</span>
                                            </p>
                                        </div>


                                        <div class="Checkout col-12 ">
                                            <button type="button">@Localizer["Checkout"] </button>
                                        </div>

                                    </div>

                                </div>
                                <div id="list">
                                    <div class="part">
                                        <i class="fa-solid fa-wallet"></i>
                                    <h6>@Localizer["Payondelivery"] Pay on delivery</h6>
                                    <p>@Localizer["Forallorders"] For all orders</p>
                                    </div>
                                    <div class="space "></div>
                                    <div class="part">
                                        <i class="fa-solid fa-arrows-rotate"></i>
                                    <h6>@Localizer["Returnpolicy"] </h6>
                                    <p>@Localizer["Mostitems"]</p>
                                    </div>
                                    <div class="space "></div>
                                    <div class="part">
                                        <i class="fa-regular fa-circle-question"></i>
                                        <h6>@Localizer["Haveaquestion?"]</h6>

                                        <p>19966</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                @foreach(var item in Model)
                {


                    <div class="container">
                        <div class="col-12 total">
                            <div class="col-8 total_product">
                                <div class="row col-12">
                                    <a class="listingWrapperSection" style="text-decoration:none; color:black" onclick="toggleDescription()">
                                        <div class="img_prototal col-1">
                                            <img id="productImg" src="@item.Image" alt="Product Image">
                                        </div>
                                    </a>
                                </div>
                                <div id="productDescription" style="">
                                    <h5>@item.Description</h5>
                                    <p>@item.Description</p>
                                </div>
                            </div>
                        </div>
                    </div>
                }

                <!-- Modal -->
                <div class="container">
                    <div id="confirmationModal" class="modal row">
                        <div class="modal-content ">
                            <div class="model_p row">
                                <p>@Localizer["Removeproduct"]</p>
                            </div>
                            <div class="content_button col-12 row">
                                <div class="col-6"><button id="cancelDelete">@Localizer["Don'tRemove"]</button></div>
                                <div class="col-6"><button id="confirmDelete">@Localizer["Remove"]</button></div>
                            </div>
                            <div class="content_center">
                                <div class="Not_sure">
                                    <p>@Localizer["Notsureyet?"]</p>
                                </div>
                                <div class="Save_later">
                                    <i class="fa-regular fa-heart"></i>
                                    <a>@Localizer["Saveforlater"]</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
        </div>



    

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        var quantityDropdown = document.getElementById("quantityDropdown");

        quantityDropdown.addEventListener("change", function () {
            document.getElementById("updateQuantityForm").submit();
        });

        $(document).ready(function () {
            $('#quantityDropdown').hide();

            $('#dropdownIcon').click(function () {
                $('#quantityDropdown').toggle();
            });
        });
    </script>
    <script src="~/js/Cart.js">

    </script>
